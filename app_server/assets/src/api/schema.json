{"openapi":"3.1.0","info":{"title":"Outline VPN","version":"1.0"},"paths":{"/api/keys/":{"post":{"tags":["Keys"],"summary":"Create Or Update Key","description":"Создать или изменить ключ доступа.","operationId":"create_or_update_key","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PutKeyRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/keys/{key_id}/":{"get":{"tags":["Keys"],"summary":"Get Key File","description":"Получить файл ключа доступа.","operationId":"get_key_file","parameters":[{"name":"key_id","in":"path","required":true,"schema":{"type":"string","title":"Key Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/order/check/":{"get":{"tags":["Orders"],"summary":"Check Order","description":"Проверка наличия заказа в системе.","operationId":"check_order","parameters":[{"name":"task_guid","in":"query","required":true,"schema":{"type":"string","description":"Идентификатор заказа","title":"Task Guid"},"description":"Идентификатор заказа"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CheckOrderResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/order/{task_guid}/":{"get":{"tags":["Orders"],"summary":"Get Order","operationId":"get_order","parameters":[{"name":"task_guid","in":"path","required":true,"schema":{"type":"string","title":"Task Guid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/payment/init/":{"get":{"tags":["Payments v1"],"summary":"Init Payment","description":"Инициализировать платеж.","operationId":"init_payment","parameters":[{"name":"task_guid","in":"query","required":true,"schema":{"type":"string","description":"Идентификатор заказа","title":"Task Guid"},"description":"Идентификатор заказа"},{"name":"is_recurrent","in":"query","required":false,"schema":{"type":"boolean","description":"Признак рекуррентности платежа","default":false,"title":"Is Recurrent"},"description":"Признак рекуррентности платежа"},{"name":"use_qr","in":"query","required":false,"schema":{"type":"boolean","description":"Оплата по QR-коду СБП","default":false,"title":"Use Qr"},"description":"Оплата по QR-коду СБП"},{"name":"amount","in":"query","required":true,"schema":{"type":"integer","minimum":1000,"description":"Сумма платежа в копейках (минимум 1000)","title":"Amount"},"description":"Сумма платежа в копейках (минимум 1000)"},{"name":"description","in":"query","required":false,"schema":{"type":"string","description":"Описание платежа","title":"Description"},"description":"Описание платежа"},{"name":"deadline","in":"query","required":false,"schema":{"type":"integer","description":"Срок жизни ссылки (дней)","default":0,"title":"Deadline"},"description":"Срок жизни ссылки (дней)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/InitPaymentResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/payment/status/":{"post":{"tags":["Payments v1"],"summary":"Payment Status Update","description":"Обновить статус платежа через систему HTTP-уведомлений банка.","operationId":"payment_status_update","requestBody":{"content":{"application/json":{"schema":{"anyOf":[{"$ref":"#/components/schemas/NotificationQrRequest"},{"$ref":"#/components/schemas/NotificationPaymentRequest"}],"title":"Payload"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/payment/{payment_id}/status/":{"get":{"tags":["Payments v1"],"summary":"Get Payment Status","description":"Получить статус платежа по его идентификатору в системе банка.","operationId":"get_payment_status","parameters":[{"name":"payment_id","in":"path","required":true,"schema":{"type":"integer","title":"Payment Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaymentStatusResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/payment/charge/":{"post":{"tags":["Payments v1"],"summary":"Payment Charge","description":"Провести автоматический периодический платеж.","operationId":"payment_charge","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"type":"string","title":"Authorization"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaymentChargeRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestStatusResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v2/payment/init/":{"get":{"tags":["Payments v2"],"summary":"Init Yookassa Payment","description":"Инициализировать платеж в YooKassa.","operationId":"init_yookassa_payment","parameters":[{"name":"task_id","in":"query","required":true,"schema":{"type":"string","description":"Идентификатор задачи","title":"Task Id"},"description":"Идентификатор задачи"},{"name":"amount","in":"query","required":true,"schema":{"type":"integer","description":"Сумма платежа в копейках (минимум 1000)","title":"Amount"},"description":"Сумма платежа в копейках (минимум 1000)"},{"name":"customer_email","in":"query","required":false,"schema":{"type":"string","description":"Почтовый ящик клиента","default":"","title":"Customer Email"},"description":"Почтовый ящик клиента"},{"name":"description","in":"query","required":false,"schema":{"type":"string","description":"Описание платежа","default":"","title":"Description"},"description":"Описание платежа"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/InitYooKassaPaymentResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/health/":{"get":{"tags":["Server"],"summary":"Health","description":"Проверка работоспособности сервиса.","operationId":"health","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestStatusResponse"}}}}}}},"/api/subscription/reject/":{"patch":{"tags":["Subscription"],"summary":"Subscription Reject","description":"Отменить активную подписку","operationId":"subscription_reject","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SubscriptionRejectRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestStatusResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/bot/messages/create/":{"post":{"tags":["Bot hooks"],"summary":"Message Create","description":"Отправить сообщение пользователю в чат.","operationId":"message_create","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OkResponse"}}}},"400":{"description":"Bad Request","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}},"/api/bot/messages/create/custom/":{"post":{"tags":["Bot hooks"],"summary":"Message Custom Create","description":"Отправить свободное сообщение пользователям в чат.","operationId":"message_custom_create","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"type":"string","title":"Authorization"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CustomMessageRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OkResponse"}}}},"400":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}},"description":"Bad Request"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"CheckOrderResponse":{"properties":{"is_valid":{"type":"boolean","title":"Is Valid"}},"type":"object","required":["is_valid"],"title":"CheckOrderResponse"},"CustomMessageRequest":{"properties":{"telegram_ids":{"items":{"type":"integer"},"type":"array","title":"Telegram Ids"},"message":{"type":"string","title":"Message"},"inline_keyboard":{"items":{"$ref":"#/components/schemas/TelegramButton"},"type":"array","title":"Inline Keyboard"}},"type":"object","required":["telegram_ids","message"],"title":"CustomMessageRequest"},"ErrorResponse":{"properties":{"error_code":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Код ошибки. 0 в случае успеха","default":"0"},"message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Краткое описание ошибки"},"details":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Подробное описание ошибки"}},"type":"object","title":"ErrorResponse"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"InitPaymentResponse":{"properties":{"payment_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Payment Id","description":"Уникальный идентификатор транзакции в системе Т‑Кассы"},"url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Url","description":"Ссылка на платежную форму"},"qr":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Qr","description":"QR-код на оплату"}},"type":"object","title":"InitPaymentResponse"},"InitYooKassaPaymentResponse":{"properties":{"payment_id":{"type":"string","title":"Payment Id","description":"Уникальный идентификатор транзакции в системе YooKassa"},"confirmation_url":{"type":"string","title":"Confirmation Url","description":"Ссылка на страницу подтверждения платежа"}},"type":"object","required":["payment_id","confirmation_url"],"title":"InitYooKassaPaymentResponse"},"NotificationPaymentRequest":{"properties":{"TerminalKey":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Идентификатор терминала"},"Amount":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Сумма в копейках"},"OrderId":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Идентификатор заказа в системе мерчанта"},"Success":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Успешность прохождения запроса"},"Status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Статус платежа"},"PaymentId":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Уникальный идентификатор транзакции в системе Т‑Кассы"},"ErrorCode":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Код ошибки. 0 в случае успеха"},"Message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Краткое описание ошибки"},"Details":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Подробное описание ошибки"},"RebillId":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Идентификатор автоплатежа"},"CardId":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Идентификатор карты в системе Т‑Кассы"},"Pan":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Замаскированный номер карты или телефона"},"ExpDate":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Срок действия карты в формате MMYY, где YY — две последние цифры года"},"Token":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Подпись запроса. Формируется по такому же принципу, как и в случае запросов в Т‑Кассу."},"Data":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Дополнительные параметры платежа, переданные при создании заказа. "}},"type":"object","title":"NotificationPaymentRequest"},"NotificationQrRequest":{"properties":{"TerminalKey":{"type":"string","title":"Идентификатор терминала."},"RequestKey":{"type":"string","title":"Идентификатор запроса на привязку счета."},"AccountToken":{"type":"string","title":"Идентификатор привязки счета, назначаемый банком-эмитентом."},"BankMemberId":{"type":"string","title":"Идентификатор банка-эмитента клиента, который будет совершать оплату по привязанному счету — заполнен, если статус ACTIVE."},"BankMemberName":{"type":"string","title":"Наименование банка-эмитента. Заполнен, если передан BankMemberId."},"NotificationType":{"type":"string","title":"Тип уведомления, всегда — LINKACCOUNT."},"Success":{"type":"boolean","title":"Успешность прохождения запроса"},"ErrorCode":{"type":"string","title":"Код ошибки. 0 в случае успеха"},"Message":{"type":"string","title":"Краткое описание ошибки"},"Token":{"type":"string","title":"Подпись запроса. Формируется по такому же принципу, как и в случае запросов в Т‑Кассу."},"Status":{"type":"string","title":"Статус платежа"}},"type":"object","required":["NotificationType"],"title":"NotificationQrRequest"},"OkResponse":{"properties":{"success":{"type":"boolean","title":"Успешность запроса","default":true},"message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Сообщение о результате запроса","default":"OK"}},"type":"object","title":"OkResponse"},"PaymentChargeRequest":{"properties":{"task_guid":{"type":"string","title":"Идентификатор задания на оплату"},"amount":{"type":"integer","minimum":1000.0,"title":"Amount","description":"Сумма платежа в копейках (минимум 1000)"},"description":{"type":"string","title":"Description","description":"Описание платежа","default":"Оплата подписки"}},"type":"object","required":["task_guid","amount"],"title":"PaymentChargeRequest"},"PaymentStatusResponse":{"properties":{"OrderId":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Orderid","description":"Идентификатор заказа в системе мерчанта"},"Status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Status","description":"Статус транзакции"},"PaymentId":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Paymentid","description":"Идентификатор платежа в системе Т‑Кассы"}},"type":"object","title":"PaymentStatusResponse"},"PutKeyRequest":{"properties":{"guid":{"type":"string","title":"Guid","description":"Идентификатор ключа"},"key":{"type":"string","title":"Key","description":"Ключ"}},"type":"object","required":["guid","key"],"title":"PutKeyRequest"},"RequestStatusResponse":{"properties":{"success":{"type":"boolean","title":"Успешность запроса"},"message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Сообщение о результате запроса"}},"type":"object","required":["success"],"title":"RequestStatusResponse"},"SubscriptionRejectRequest":{"properties":{"task_guid":{"type":"string","title":"Task Guid"}},"type":"object","required":["task_guid"],"title":"SubscriptionRejectRequest"},"TelegramButton":{"properties":{"text":{"type":"string","title":"Text"},"callback_data":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Callback Data","description":"Данные, которые будут отправлены в колбэке боту при нажатии кнопки"},"url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Url","description":"URL, который будет открыт при нажатии кнопки"}},"type":"object","required":["text"],"title":"TelegramButton"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}